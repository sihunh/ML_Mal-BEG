import joblib
import numpy as np
from Training_model import extract_features
from sklearn.feature_extraction import DictVectorizer

# 모델과 벡터라이저 로드
model = joblib.load('malware_detection_model.joblib')
vectorizer = joblib.load('feature_vectorizer.joblib')

def predict_malware(file_path):
    # 파일에서 특성 추출
    features = extract_features(file_path)
    
    # 특성을 벡터화
    feature_vector = vectorizer.transform([features])
    
    # 예측 수행
    prediction = model.predict(feature_vector)[0]
    probabilities = model.predict_proba(feature_vector)[0]
    
    # 신뢰도 계산
    confidence = float(probabilities[1]) if len(probabilities) > 1 else float(probabilities[0])
    
    # NumPy int64를 Python int로 변환
    prediction = int(prediction)
    
    return prediction, confidence

